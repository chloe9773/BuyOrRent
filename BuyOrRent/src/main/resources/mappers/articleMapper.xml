<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="article">
	<!-- 게시글 insert -->
	<insert id="setArticle" parameterType="articlevo">
		INSERT INTO article SET 
			board_id = #{boardId},
			article_type = #{articleType},
			article_title = #{title},
			article_author = #{author},
			article_date = now(),
			content = #{content}
	</insert>
	
	<!-- 게시글 하나 불러오기 -->
	<select id="getArticleOne" parameterType="int" resultType="articlevo">
		SELECT
			a.board_id as boardId,  
			a.article_id as articleId,
			a.article_type as articleType,
			a.article_title as title,
			a.article_author as author,
			a.article_date as uploadDate,
			a.article_update as updateDate,
			a.article_hit as hit,
			(SELECT COUNT(*) FROM comments WHERE aid = a.article_id) as commentTotal,
			content 
		FROM article a WHERE a.article_id = #{articleId}
	</select>
	
	<!-- 게시판별 게시글 불러오기(공지게시글) -->
	<select id="getNotiArticleForBoard" parameterType="int" resultType="articlevo">
		SELECT 
			a.article_id as articleId,
			a.article_type as articleType,
			a.article_title as title,
			a.article_author as author,
			a.article_date as uploadDate,
			a.article_hit as hit,
			(SELECT COUNT(*) FROM comments WHERE aid = a.article_id) as commentTotal,
			content 
		FROM article a WHERE a.board_id = #{boardId} and a.article_type != 'general' ORDER BY a.article_id
	</select>
	
	<!-- 게시판별 게시글 불러오기(일반게시글) -->
	<select id="getAllArticleForBoard" parameterType="hashmap" resultType="articlevo">
		SELECT 
			a.article_id as articleId,
			a.article_type as articleType,
			a.article_title as title,
			a.article_author as author,
			a.article_date as uploadDate,
			a.article_hit as hit,
			(SELECT COUNT(*) FROM comments WHERE aid = a.article_id) as commentTotal,
			content 
		FROM article a WHERE a.board_id = #{id} and a.article_type != 'noti' ORDER BY a.article_id DESC LIMIT #{start}, #{end}
	</select>
	
	<!-- 게시글 삭제 -->
	<delete id="deleteArticleOne" parameterType="int">
		DELETE FROM article WHERE article_id = #{articleId}
	</delete>
	
	<!-- 게시글 수정 -->
	<update id="updateArticleOne" parameterType="articlevo">
		UPDATE article SET 
			article_title = #{title},
			article_update = now(),
			content = #{content} 
		WHERE article_id = #{articleId}
	</update>
	
	<!-- 게시글 등록 -->
	<insert id="setComment" parameterType="commentvo">
		INSERT INTO comments SET 
			aid = #{aid},
			author = #{author},
			content = #{cContent},
			regdate = NOW()
	</insert>	
	
	<!-- 게시글 댓글 가져오기 -->
	<select id="getArticleComments" parameterType="int" resultType="commentvo">
		SELECT 
			cid, aid, author, content as cContent, regdate as regDate, update_date as updateDate  
		FROM comments WHERE aid = #{articleId}
	</select>
	
	<!-- 게시글 댓글 카운트 -->
	<select id="getArticleCommentsTotal" parameterType="int" resultType="int">
		SELECT 
			cid, aid, author, content as cContent, regdate as regDate, update_date as updateDate 
		FROM comments WHERE aid = #{articleId}
	</select>
	
	<!-- 게시글 삭제 -->
	<delete id="deleteComment" parameterType="int">
		DELETE FROM comments WHERE cid = #{cid}
	</delete>
	
	<!-- 게시글 수정 -->
	<update id="updateComment" parameterType="commentvo">
		UPDATE comments SET 
			content = #{content},
			update_date = NOW()
	</update>
</mapper> 